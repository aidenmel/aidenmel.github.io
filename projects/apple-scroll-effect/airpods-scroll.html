<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/projects/apple-scroll-effect/as-styles.css">
    <title>Airpod Scroll Test</title>
</head>
<body>
    <div class="img-content" id="animation-effect-test">
        <h1>Airpods Pro</h1>
        <p>Redefining the listening experience.</p>
        <button>Purchase</button>
    </div>
    <script>
        var startAt = 250;
        var endAt = 2000;

        var testContainer = document.getElementById('animation-effect-test')

        window.addEventListener('scroll', (e) => {
            const scrollTop = html.scrollTop;
            
            var percent = (scrollTop - startAt) / (endAt - startAt)

            if (percent >= -80){
                percent == -0;
            } else if (percent <= -920){
                percent == -999.9999
            }

            if (scrollTop > startAt && scrollTop < endAt){ // If the scroll exceeds the start
                testContainer.style.animationDelay = -(percent * 1000) + "s"
                testContainer.style.display = 'block';
                console.log('starting', -(percent * 1000) + "s")
            } else { // If the scroll value is before or after the entire effect
                testContainer.style.display = 'none';
                console.log('out of view')
            };
        });
    </script>

    <canvas id="hero-lightpass" />
    <script>
        const html = document.documentElement
        const canvas = document.getElementById('hero-lightpass');
        const context = canvas.getContext('2d');

        const frameCount = 148
        const currentFrame = index => (
            `https://www.apple.com/105/media/us/airpods-pro/2019/1299e2f5_9206_4470_b28e_08307a42f19b/anim/sequence/large/01-hero-lightpass/${index.toString().padStart(4, '0')}.jpg`
        )

        const preloadImages = () => {
            for (let i = 1; i < frameCount; i++) {
                const img = new Image();
                img.src = currentFrame(i);
            }
        }

        const img = new Image()
        img.src = currentFrame(1);
        img.onload=function(){
            context.drawImage(img,0,0);
        }
        canvas.width = 1158;
        canvas.height = 770;

        const updateImage = index => {
            img.src = currentFrame(index);
            context.drawImage(img, 0, 0)
        }

        window.addEventListener('scroll', (e) => {
            const scrollTop = html.scrollTop;
            const maxScrollTop = html.scrollHeight - window.innerHeight;
            const scrollFraction = scrollTop / maxScrollTop
            const frameIndex = Math.min(frameCount - 1, Math.ceil(scrollFraction * frameCount));

            requestAnimationFrame(() =>
            updateImage(frameIndex + 1))
        });

        preloadImages()

</script>

</body>
</html>