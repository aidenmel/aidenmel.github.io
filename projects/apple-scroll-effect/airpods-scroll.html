<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/projects/apple-scroll-effect/as-styles.css">
    <title>Airpod Scroll Test</title>
</head>
<body>
    <div class="img-content" id="animation-effect-test">
        <h1>Airpods Pro</h1>
        <p>Redefining the listening experience.</p>
        <button>Purchase</button>
    </div>
    <script>
        var startAt = 250;
        var endAt = 2000;

        var testContainer = document.getElementById('animation-effect-test')

        window.addEventListener('scroll', (e) => {
            const scrollTop = html.scrollTop;
            
            var finishPoint = startAt + finishEffectAfter;
            var numerator = scrollTop - startAt;

            if (scrollTop > startAt && scrollTop < endAt){ // If the scroll exceeds the start
                testContainer.style.opacity =  numerator/finishEffectAfter;
                testContainer.style.display = 'block';
                console.log('starting', numerator/finishEffectAfter)
            } else { // If the scroll value is before or after the entire effect
                testContainer.style.display = 'none';
                console.log('out of view')
            };
        });
    </script>

    <div class="legacy-img-content" id="test-effect">
        <h1>Airpods Pro</h1>
        <p>Redefining the listening experience.</p>
        <button>Purchase</button>
    </div>
    <script>
        var startAt = 250;
        var finishEffectAfter = 500;
        var endAt = 2000;

        var testContainer = document.getElementById('test-effect')

        window.addEventListener('scroll', (e) => {
            const scrollTop = html.scrollTop;
            const maxScrollTop = html.scrollHeight - window.innerHeight;
            const scrollFraction = scrollTop / maxScrollTop;
            
            var finishPoint = startAt + finishEffectAfter;
            var numerator = scrollTop - startAt;

            if (scrollTop > startAt && scrollTop < finishPoint){ // If the scroll exceeds the start
                testContainer.style.opacity =  numerator/finishEffectAfter;
                testContainer.style.display = 'block';
                console.log('starting', numerator/finishEffectAfter)
            } else if (scrollTop > finishPoint && scrollTop < endAt - finishEffectAfter){ // If the scroll exceeds the finish point but not the start of the zoom out effect
                testContainer.style.opacity = 1;
                testContainer.style.display = 'block';
                console.log('midpoint')
            } else if (scrollTop > endAt - finishEffectAfter && scrollTop < endAt){ // If the scroll exceeds the end point
                var num = (scrollTop - endAt + finishEffectAfter);
                var denom = endAt;
                testContainer.style.opacity = -((scrollTop - endAt)/finishEffectAfter);
                testContainer.style.display = 'block';
                console.log('ending', scrollTop, testContainer.style.opacity)
            } else { // If the scroll value is before or after the entire effect
                testContainer.style.opacity = 0;
                testContainer.style.display = 'none';
                console.log('out of view')
            };
        });

    </script>


    <canvas id="hero-lightpass" />
    <script>
        const html = document.documentElement
        const canvas = document.getElementById('hero-lightpass');
        const context = canvas.getContext('2d');

        const frameCount = 148
        const currentFrame = index => (
            `https://www.apple.com/105/media/us/airpods-pro/2019/1299e2f5_9206_4470_b28e_08307a42f19b/anim/sequence/large/01-hero-lightpass/${index.toString().padStart(4, '0')}.jpg`
        )

        const preloadImages = () => {
            for (let i = 1; i < frameCount; i++) {
                const img = new Image();
                img.src = currentFrame(i);
            }
        }

        const img = new Image()
        img.src = currentFrame(1);
        img.onload=function(){
            context.drawImage(img,0,0);
        }
        canvas.width = 1158;
        canvas.height = 770;

        const updateImage = index => {
            img.src = currentFrame(index);
            context.drawImage(img, 0, 0)
        }

        window.addEventListener('scroll', (e) => {
            const scrollTop = html.scrollTop;
            const maxScrollTop = html.scrollHeight - window.innerHeight;
            const scrollFraction = scrollTop / maxScrollTop
            const frameIndex = Math.min(frameCount - 1, Math.ceil(scrollFraction * frameCount));

            requestAnimationFrame(() =>
            updateImage(frameIndex + 1))
        });

        preloadImages()

</script>

</body>
</html>