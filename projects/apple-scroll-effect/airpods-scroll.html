<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/projects/apple-scroll-effect/as-styles.css">
    <title>Airpod Scroll Test</title>
</head>
<body>
    <div class="img-content scroll-responsive" id="animation-effect-test" fx-start="250" fx-end="2600">
        <h1>Airpods Pro</h1>
        <p>Redefining the listening experience.</p>
        <button>Purchase</button>
    </div>
    <script>
      
        var ScrollResponsiveObjects = document.getElementsByClassName('scroll-responsive');
        window.addEventListener('scroll', (e) => {
            
          // Get scroll position
          var ScrollPos = html.scrollTop;

          // Loop through scroll-responsive objects
          for (let i = 0; i < ScrollResponsiveObjects.length; i++) {
          
             var Object = ScrollResponsiveObjects[i];
             var ObjectStart = Object.getAttribute('fx-start'); 
             var ObjectEnd = Object.getAttribute('fx-end');
  
             if (ScrollPos > ObjectStart && ScrollPos < ObjectEnd){
               
               var Percentage = (ScrollPos - ObjectStart)/(ObjectEnd - ObjectStart);
               
               // Set restrictions to percents
               if (Percentage >= -80){
                 Percentage == -0;
               } else if (Percentage <= -920){
                 Percentage == -999.99;
               }
               
               // Set effect (if it meets the criteria)
               Object.style.animationDelay = -(Percentage * 1000) + 's';
               Object.style.display = 'block';
             } else {
               Object.style.display = 'none';
             }
           }
        })
    </script>

    <canvas id="hero-lightpass" />
    <script>
        const html = document.documentElement
        const canvas = document.getElementById('hero-lightpass');
        const context = canvas.getContext('2d');

        const frameCount = 148
        const currentFrame = index => (
            `https://www.apple.com/105/media/us/airpods-pro/2019/1299e2f5_9206_4470_b28e_08307a42f19b/anim/sequence/large/01-hero-lightpass/${index.toString().padStart(4, '0')}.jpg`
        )

        const preloadImages = () => {
            for (let i = 1; i < frameCount; i++) {
                const img = new Image();
                img.src = currentFrame(i);
            }
        }

        const img = new Image()
        img.src = currentFrame(1);
        img.onload=function(){
            context.drawImage(img,0,0);
        }
        canvas.width = 1158;
        canvas.height = 770;

        const updateImage = index => {
            img.src = currentFrame(index);
            context.drawImage(img, 0, 0)
        }

        window.addEventListener('scroll', (e) => {
            const scrollTop = html.scrollTop;
            const maxScrollTop = html.scrollHeight - window.innerHeight;
            const scrollFraction = scrollTop / maxScrollTop
            const frameIndex = Math.min(frameCount - 1, Math.ceil(scrollFraction * frameCount));

            requestAnimationFrame(() =>
            updateImage(frameIndex + 1))
        });

        preloadImages()

</script>

</body>
</html>